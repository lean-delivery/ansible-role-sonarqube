---
# tasks file for sonarqube

- name: Get info
  command: 'yum info nginx'
  register: info
  changed_when: false

- debug:
    var: info.stdout

- name: "(Install: CentOS/RedHat) Add NGINX Repository"
  yum_repository:
    name: nginx
    baseurl: https://nginx.org/packages/mainline/centos/7/$basearch/
    description: NGINX Repository
    enabled: true
    gpgcheck: true

- name: Get info
  command: 'yum info nginx'
  register: info
  changed_when: false

- debug:
    var: info.stdout

- name: "(Install: CentOS/RedHat) Install NGINX"
  yum:
    name: nginx
    state: present
    disablerepo: *
    enablerepo: nginx
  register: install_result
  until: install_result is succeeded
  retries: 3
  delay: 5

- name: Choose platform based task
  include_tasks: '{{ platform }}'
  with_first_found:
    - 'system/{{ ansible_facts.system }}.yml'
    - 'system/not-supported.yml'
  loop_control:
    loop_var: platform
